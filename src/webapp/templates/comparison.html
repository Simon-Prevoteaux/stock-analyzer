{% extends "base.html" %}

{% block title %}Stock Comparison{% endblock %}

{% block content %}
<h1>Compare Stocks</h1>

<div class="comparison-search">
    <form method="GET">
        <div class="form-group">
            <label for="tickers">Enter tickers to compare (comma-separated):</label>
            <input type="text" id="tickers" name="tickers" placeholder="AAPL, MSFT, GOOGL" required>
        </div>
        <button type="submit" class="btn btn-primary">Compare</button>
    </form>
</div>

<div class="comparison-suggestions">
    <h2>Quick Comparison Groups</h2>
    <p class="subtitle">Select a pre-defined group to compare</p>

    <div class="suggestions-grid">
        {% for sugg_id, sugg_data in suggestions.items() %}
        {% if sugg_data.tickers %}
        <div class="suggestion-card">
            <h4>{{ sugg_data.name }}</h4>
            <p class="description">{{ sugg_data.description }}</p>
            <p class="ticker-preview">{{ sugg_data.tickers[:5]|join(', ') }}{% if sugg_data.tickers|length > 5 %}...{% endif %}</p>
            <button type="button" class="btn btn-sm btn-secondary" onclick="compareTickers('{{ sugg_data.tickers|join(',') }}')">
                Compare These
            </button>
        </div>
        {% endif %}
        {% endfor %}
    </div>
</div>

<script>
function compareTickers(tickers) {
    window.location.href = '{{ url_for("comparison") }}?tickers=' + encodeURIComponent(tickers);
}
</script>

{% if stocks %}
<div class="comparison-table-container">
    <table class="comparison-table">
        <thead>
            <tr>
                <th>Metric</th>
                {% for stock in stocks %}
                <th>{{ stock.ticker }}</th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><strong>Company Name</strong></td>
                {% for stock in stocks %}
                <td>{{ stock.company_name }}</td>
                {% endfor %}
            </tr>
            <tr>
                <td><strong>Sector</strong></td>
                {% for stock in stocks %}
                <td>{{ stock.sector }}</td>
                {% endfor %}
            </tr>
            <tr>
                <td><strong>Market Cap</strong></td>
                {% for stock in stocks %}
                <td>{{ stock.market_cap|format_number }}</td>
                {% endfor %}
            </tr>
            <tr>
                <td><strong>Current Price</strong></td>
                {% for stock in stocks %}
                <td>${{ stock.current_price }}</td>
                {% endfor %}
            </tr>
            <tr>
                <td><strong>P/E Ratio</strong></td>
                {% for stock in stocks %}
                <td>{{ stock.pe_ratio|format_ratio }}</td>
                {% endfor %}
            </tr>
            <tr>
                <td><strong>Forward P/E</strong></td>
                {% for stock in stocks %}
                <td>{{ stock.forward_pe|format_ratio }}</td>
                {% endfor %}
            </tr>
            <tr>
                <td><strong>P/S Ratio</strong></td>
                {% for stock in stocks %}
                <td>{{ stock.ps_ratio|format_ratio }}</td>
                {% endfor %}
            </tr>
            <tr>
                <td><strong>Revenue</strong></td>
                {% for stock in stocks %}
                <td>{{ stock.revenue|format_number }}</td>
                {% endfor %}
            </tr>
            <tr>
                <td><strong>Revenue Growth</strong></td>
                {% for stock in stocks %}
                <td>{{ stock.revenue_growth|format_percent }}</td>
                {% endfor %}
            </tr>
            <tr>
                <td><strong>EPS</strong></td>
                {% for stock in stocks %}
                <td>${{ stock.eps }}</td>
                {% endfor %}
            </tr>
            <tr>
                <td><strong>Profit Margin</strong></td>
                {% for stock in stocks %}
                <td>{{ stock.profit_margin|format_percent }}</td>
                {% endfor %}
            </tr>
            <tr>
                <td><strong>Profitable</strong></td>
                {% for stock in stocks %}
                <td>{% if stock.is_profitable %}Yes{% else %}No{% endif %}</td>
                {% endfor %}
            </tr>
            <tr>
                <td><strong>Bubble Score</strong></td>
                {% for stock in stocks %}
                <td>{{ stock.bubble_score }}/10</td>
                {% endfor %}
            </tr>
            <tr>
                <td><strong>Risk Level</strong></td>
                {% for stock in stocks %}
                <td><span class="risk-badge risk-{{ stock.risk_level|lower|replace(' ', '-') }}">{{ stock.risk_level }}</span></td>
                {% endfor %}
            </tr>
        </tbody>
    </table>
</div>
{% elif request.args.get('tickers') %}
<p class="no-results">No stocks found for the provided tickers.</p>
{% endif %}
{% endblock %}
