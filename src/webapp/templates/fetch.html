{% extends "base.html" %}

{% block title %}Fetch Stock Data{% endblock %}

{% block content %}
<h1>Fetch Stock Data</h1>

{% if success %}
<div class="alert alert-success">
    {{ message }}
</div>
{% endif %}

{% if error %}
<div class="alert alert-error">
    {{ message }}
</div>
{% endif %}

<div class="form-container">
    <form method="POST">
        <div class="form-group">
            <label for="tickers">Stock Tickers (comma-separated):</label>
            <input type="text" id="tickers" name="tickers" placeholder="AAPL, MSFT, GOOGL, NVDA" required>
            <small>Enter stock ticker symbols separated by commas</small>
        </div>

        <button type="submit" class="btn btn-primary">Fetch Data</button>
    </form>
</div>

<div class="refresh-container">
    <h2>Refresh Existing Data</h2>
    <p class="subtitle">Update all stocks in your database with the latest data</p>
    <form method="POST" action="{{ url_for('refresh_all_stocks') }}" onsubmit="return confirm('This will refresh all stocks in your database. Continue?');">
        <button type="submit" class="btn btn-secondary">Refresh All Stocks</button>
    </form>
</div>

<div class="stock-suggestions">
    <h2>Quick Add Stock Lists</h2>
    <p class="subtitle">Click on a list to automatically populate the ticker field</p>

    <div class="suggestions-grid">
        {% for list_id, list_data in stock_lists.items() %}
        <div class="suggestion-card">
            <h4>{{ list_data.name }}</h4>
            <p class="description">{{ list_data.description }}</p>
            <p class="ticker-count">{{ list_data.tickers|length }} stocks</p>
            <button type="button" class="btn btn-sm btn-secondary" onclick="fillTickers('{{ list_data.tickers|join(', ') }}')">
                Add to Field
            </button>
        </div>
        {% endfor %}
    </div>
</div>

<script>
function fillTickers(tickers) {
    document.getElementById('tickers').value = tickers;
    // Scroll to the form
    document.querySelector('.form-container').scrollIntoView({ behavior: 'smooth' });
}
</script>
{% endblock %}
