{% extends "base.html" %}

{% block title %}Technical Analysis - Basic{% endblock %}

{% block content %}
<div class="page-header">
    <h2>Technical Analysis - Basic</h2>
    <p class="subtitle">Support/Resistance levels and trend-based price forecasts</p>
</div>

<!-- Stock Selector -->
<div class="card">
    <h3>Select Stock</h3>
    <form method="GET" action="{{ url_for('technical.technical_analysis_basic') }}" id="stock-search-form">
        <div class="form-group">
            <label for="ticker-search">Search for a stock:</label>
            <div class="search-container">
                <input type="text"
                       id="ticker-search"
                       placeholder="Type ticker symbol (e.g., AAPL, MSFT)..."
                       autocomplete="off"
                       value="{{ ticker or '' }}">
                <input type="hidden" name="ticker" id="ticker-hidden" value="{{ ticker or '' }}">
                <div class="search-results" id="search-results"></div>
            </div>
        </div>
    </form>
</div>

<script>
(function() {
    const availableStocks = {{ available_stocks | tojson | safe }};
    const searchInput = document.getElementById('ticker-search');
    const hiddenInput = document.getElementById('ticker-hidden');
    const resultsDiv = document.getElementById('search-results');
    const form = document.getElementById('stock-search-form');

    searchInput.addEventListener('input', function() {
        const query = this.value.toUpperCase().trim();
        resultsDiv.innerHTML = '';

        if (query.length === 0) {
            resultsDiv.style.display = 'none';
            return;
        }

        const matches = availableStocks.filter(stock =>
            stock.toUpperCase().includes(query)
        ).slice(0, 10);

        if (matches.length > 0) {
            resultsDiv.style.display = 'block';
            matches.forEach(stock => {
                const div = document.createElement('div');
                div.className = 'search-result-item';
                div.textContent = stock;
                div.addEventListener('click', function() {
                    searchInput.value = stock;
                    hiddenInput.value = stock;
                    resultsDiv.style.display = 'none';
                    form.submit();
                });
                resultsDiv.appendChild(div);
            });
        } else {
            resultsDiv.style.display = 'none';
        }
    });

    // Hide results when clicking outside
    document.addEventListener('click', function(e) {
        if (!searchInput.contains(e.target)) {
            resultsDiv.style.display = 'none';
        }
    });
})();
</script>

{% if error %}
<div class="card error-card">
    <h3>Error</h3>
    <p class="error-message">{{ error }}</p>
    {% if ticker and not stock_info %}
    <a href="{{ url_for('core.fetch_stocks') }}" class="btn btn-primary">Fetch Stock Data</a>
    {% endif %}
</div>
{% endif %}

{% if ticker and stock_info and technical_data %}
<!-- Stock Info Header -->
<div class="forecast-header">
    <h2>{{ stock_info.company_name }} ({{ ticker }})</h2>
    <div class="current-price">
        <span class="label">Current Price:</span>
        <span class="value">${{ "%.2f"|format(stock_info.current_price) }}</span>
    </div>
    <div class="header-actions">
        <a href="{{ url_for('core.stock_detail', ticker=ticker) }}" class="btn btn-secondary">View Details</a>
        <form method="POST" action="{{ url_for('technical.api_refresh_price_history', ticker=ticker) }}" class="form-inline">
            <button type="submit" class="btn btn-secondary">Refresh Price Data</button>
        </form>
    </div>
</div>

<!-- Data Info Banner -->
<div class="card data-info-card">
    <p class="sector-info">{{ stock_info.sector }} / {{ stock_info.industry }}</p>
    <p>Analysis based on <strong>{{ technical_data.data_points }} days</strong> of price data
       ({{ technical_data.oldest_date }} to {{ technical_data.newest_date }})</p>
</div>

<!-- Price Chart -->
<div class="card">
    <h3>Price History (2 Years)</h3>
    <div class="chart-container">
        <canvas id="priceChart"></canvas>
    </div>
</div>

<script>
(function() {
    const chartData = {{ chart_data | tojson | safe }};
    const ctx = document.getElementById('priceChart').getContext('2d');

    new Chart(ctx, {
        type: 'line',
        data: chartData,
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: true,
                    labels: { color: '#e0e6ed' }
                },
                tooltip: {
                    mode: 'index',
                    intersect: false,
                    callbacks: {
                        label: function(context) {
                            let label = context.dataset.label || '';
                            if (label) {
                                label += ': ';
                            }
                            if (context.parsed.y !== null) {
                                label += '$' + context.parsed.y.toFixed(2);
                            }
                            return label;
                        }
                    }
                }
            },
            scales: {
                x: {
                    grid: { color: 'rgba(0, 255, 136, 0.1)' },
                    ticks: { color: '#a8b2d1', maxTicksLimit: 12 }
                },
                y: {
                    grid: { color: 'rgba(0, 255, 136, 0.1)' },
                    ticks: {
                        color: '#a8b2d1',
                        callback: function(value) {
                            return '$' + value.toFixed(2);
                        }
                    }
                }
            }
        }
    });
})();
</script>

<!-- Two Column Layout: Trend Analysis + Support/Resistance -->
<div class="technical-grid">
    <!-- Left Column: Trend Analysis -->
    <div class="card">
        <h3>
            Trend-Based Forecast
            <button type="button" class="info-btn" onclick="showInfo('trend-forecast')">i</button>
        </h3>
        {% if technical_data.trend %}
        <div class="trend-section">
            <div class="trend-header">
                <span class="trend-badge {{ 'bullish' if technical_data.trend.trend_direction == 'Bullish' else 'bearish' }}">
                    {{ technical_data.trend.trend_direction }}
                </span>
                <span class="r-squared">R² = {{ "%.4f"|format(technical_data.trend.r_squared) }}</span>
            </div>

            <table class="detail-table">
                <tr>
                    <td>Current Price</td>
                    <td><strong>${{ "%.2f"|format(technical_data.trend.current_price) }}</strong></td>
                </tr>
                {% if technical_data.trend.ma_20 %}
                <tr>
                    <td>20-Day MA</td>
                    <td>${{ "%.2f"|format(technical_data.trend.ma_20) }}</td>
                </tr>
                {% endif %}
                {% if technical_data.trend.ma_50 %}
                <tr>
                    <td>50-Day MA</td>
                    <td>${{ "%.2f"|format(technical_data.trend.ma_50) }}</td>
                </tr>
                {% endif %}
                <tr class="separator">
                    <td colspan="2"><strong>Projected Targets</strong></td>
                </tr>
                <tr>
                    <td>30-Day Target</td>
                    <td>
                        ${{ "%.2f"|format(technical_data.trend.target_30d) }}
                        <span class="upside {{ 'positive' if technical_data.trend.upside_30d_percent > 0 else 'negative' }}">
                            {{ "%.2f"|format(technical_data.trend.upside_30d_percent) }}%
                        </span>
                    </td>
                </tr>
                <tr>
                    <td>90-Day Target</td>
                    <td>
                        ${{ "%.2f"|format(technical_data.trend.target_90d) }}
                        <span class="upside {{ 'positive' if technical_data.trend.upside_90d_percent > 0 else 'negative' }}">
                            {{ "%.2f"|format(technical_data.trend.upside_90d_percent) }}%
                        </span>
                    </td>
                </tr>
            </table>

            <div class="trend-note">
                <p><strong>Note:</strong> Trend analysis uses linear regression on the last 90 days.
                   R² value indicates trend strength (higher is stronger).</p>
            </div>
        </div>
        {% else %}
        <p class="no-data">Insufficient data for trend analysis</p>
        {% endif %}
    </div>

    <!-- Right Column: Support/Resistance -->
    <div class="card">
        <h3>
            Support & Resistance Levels
            <button type="button" class="info-btn" onclick="showInfo('support-resistance')">i</button>
        </h3>
        {% if technical_data.support_levels or technical_data.resistance_levels %}
        <div class="sr-section">
            <div class="sr-levels">
                <div class="resistance-levels">
                    <h4>Resistance Levels</h4>
                    {% if technical_data.resistance_levels %}
                    <ul class="level-list">
                        {% for level in technical_data.resistance_levels|reverse %}
                        <li class="resistance-item">
                            <span class="level-price">${{ "%.2f"|format(level) }}</span>
                            {% if technical_data.price_targets.next_resistance == level %}
                            <span class="badge next">Next Target</span>
                            {% endif %}
                        </li>
                        {% endfor %}
                    </ul>
                    {% else %}
                    <p class="no-data">No resistance levels identified</p>
                    {% endif %}
                </div>

                <div class="current-price-marker">
                    <span class="marker-line"></span>
                    <span class="marker-label">Current: ${{ "%.2f"|format(technical_data.price_targets.current_price) }}</span>
                </div>

                <div class="support-levels">
                    <h4>Support Levels</h4>
                    {% if technical_data.support_levels %}
                    <ul class="level-list">
                        {% for level in technical_data.support_levels|reverse %}
                        <li class="support-item">
                            <span class="level-price">${{ "%.2f"|format(level) }}</span>
                            {% if technical_data.price_targets.next_support == level %}
                            <span class="badge next">Next Support</span>
                            {% endif %}
                        </li>
                        {% endfor %}
                    </ul>
                    {% else %}
                    <p class="no-data">No support levels identified</p>
                    {% endif %}
                </div>
            </div>

            <!-- Price Targets Summary -->
            <div class="price-targets-summary">
                <h4>Key Levels</h4>
                <table class="detail-table">
                    {% if technical_data.price_targets.next_resistance %}
                    <tr>
                        <td>Next Resistance</td>
                        <td>
                            ${{ "%.2f"|format(technical_data.price_targets.next_resistance) }}
                            <span class="upside positive">
                                +{{ "%.2f"|format(technical_data.price_targets.upside_to_resistance) }}%
                            </span>
                        </td>
                    </tr>
                    {% endif %}
                    {% if technical_data.price_targets.next_support %}
                    <tr>
                        <td>Next Support</td>
                        <td>
                            ${{ "%.2f"|format(technical_data.price_targets.next_support) }}
                            <span class="downside negative">
                                -{{ "%.2f"|format(technical_data.price_targets.downside_to_support) }}%
                            </span>
                        </td>
                    </tr>
                    {% endif %}
                </table>
            </div>

            <div class="sr-note">
                <p><strong>Methodology:</strong> Levels identified using local maxima/minima clustering.
                   Stronger levels have been tested multiple times.</p>
            </div>
        </div>
        {% else %}
        <p class="no-data">No support/resistance levels identified</p>
        {% endif %}
    </div>
</div>

<!-- Pivot Points -->
{% if technical_data.pivot_points %}
<div class="card">
    <h3>
        Classical Pivot Points
        <button type="button" class="info-btn" onclick="showInfo('pivot-points')">i</button>
    </h3>
    <div class="pivot-section">
        <p class="info-text">Based on most recent trading period (High/Low/Close)</p>
        <table class="pivot-table">
            <thead>
                <tr>
                    <th>R3</th>
                    <th>R2</th>
                    <th>R1</th>
                    <th class="pivot-col">Pivot</th>
                    <th>S1</th>
                    <th>S2</th>
                    <th>S3</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>${{ "%.2f"|format(technical_data.pivot_points.r3) }}</td>
                    <td>${{ "%.2f"|format(technical_data.pivot_points.r2) }}</td>
                    <td>${{ "%.2f"|format(technical_data.pivot_points.r1) }}</td>
                    <td class="pivot-col"><strong>${{ "%.2f"|format(technical_data.pivot_points.pivot) }}</strong></td>
                    <td>${{ "%.2f"|format(technical_data.pivot_points.s1) }}</td>
                    <td>${{ "%.2f"|format(technical_data.pivot_points.s2) }}</td>
                    <td>${{ "%.2f"|format(technical_data.pivot_points.s3) }}</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
{% endif %}

<!-- Summary Section -->
<div class="card summary-section">
    <h3>Technical Analysis Summary</h3>
    <div class="summary-grid">
        <div class="summary-item">
            <span class="summary-label">Trend Direction:</span>
            <span class="summary-value trend-badge {{ 'bullish' if technical_data.trend.trend_direction == 'Bullish' else 'bearish' }}">
                {{ technical_data.trend.trend_direction }}
            </span>
        </div>
        <div class="summary-item">
            <span class="summary-label">90-Day Trend Target:</span>
            <span class="summary-value">${{ "%.2f"|format(technical_data.trend.target_90d) }}</span>
        </div>
        <div class="summary-item">
            <span class="summary-label">Next Resistance:</span>
            <span class="summary-value">
                {% if technical_data.price_targets.next_resistance %}
                ${{ "%.2f"|format(technical_data.price_targets.next_resistance) }}
                {% else %}
                N/A
                {% endif %}
            </span>
        </div>
        <div class="summary-item">
            <span class="summary-label">Next Support:</span>
            <span class="summary-value">
                {% if technical_data.price_targets.next_support %}
                ${{ "%.2f"|format(technical_data.price_targets.next_support) }}
                {% else %}
                N/A
                {% endif %}
            </span>
        </div>
    </div>
</div>

{% endif %}

<!-- Info Modal -->
<div class="info-modal-overlay" id="info-modal-overlay" onclick="closeInfo()">
    <div class="info-modal" onclick="event.stopPropagation()">
        <button class="info-modal-close" onclick="closeInfo()">&times;</button>
        <h3 id="info-modal-title"></h3>
        <div id="info-modal-content"></div>
    </div>
</div>

<script>
const infoContent = {
    'support-resistance': {
        title: 'Support & Resistance Levels',
        content: `
            <p><strong>What they are:</strong> Support and resistance are key price levels where a stock tends to stop falling (support) or stop rising (resistance).</p>

            <p><strong>Support Levels:</strong></p>
            <ul>
                <li>Price levels where buying pressure is strong enough to prevent the price from falling further</li>
                <li>Think of it as a "floor" that the price bounces off of</li>
                <li>When a stock reaches a support level, buyers tend to step in</li>
                <li>If support breaks, the price may continue falling to the next support level</li>
            </ul>

            <p><strong>Resistance Levels:</strong></p>
            <ul>
                <li>Price levels where selling pressure is strong enough to prevent the price from rising further</li>
                <li>Think of it as a "ceiling" that the price struggles to break through</li>
                <li>When a stock reaches resistance, sellers tend to take profits</li>
                <li>If resistance breaks, the price may continue rising to the next resistance level</li>
            </ul>

            <p><strong>How we calculate them:</strong></p>
            <ul>
                <li>We scan the last 2 years of price history</li>
                <li>Identify local peaks (resistance) and valleys (support) using a 20-day window</li>
                <li>Group nearby levels together (within 2% of each other)</li>
                <li>Show you the 3 strongest levels based on how many times they've been "tested"</li>
            </ul>

            <p><strong>How to use them:</strong></p>
            <ul>
                <li><strong>For buying:</strong> Look for the stock to approach support levels - potential entry points</li>
                <li><strong>For selling:</strong> Watch resistance levels - potential profit-taking points</li>
                <li><strong>Breakouts:</strong> When price breaks through resistance with high volume, it often becomes new support</li>
                <li><strong>Breakdowns:</strong> When price breaks below support, it often becomes new resistance</li>
            </ul>
        `
    },
    'trend-forecast': {
        title: 'Trend-Based Forecast',
        content: `
            <p><strong>What it is:</strong> A statistical prediction of where the stock price might go based on its recent price movement trend.</p>

            <p><strong>How it works:</strong></p>
            <ul>
                <li>We analyze the last 90 days of price data</li>
                <li>Use linear regression to find the trend line (the "best fit" line through recent prices)</li>
                <li>Project this trend forward to estimate prices 30 and 90 days from now</li>
            </ul>

            <p><strong>Key Components:</strong></p>
            <ul>
                <li><strong>Trend Direction:</strong>
                    <ul>
                        <li><em>Bullish:</em> Price is trending upward over the last 90 days</li>
                        <li><em>Bearish:</em> Price is trending downward over the last 90 days</li>
                    </ul>
                </li>
                <li><strong>R² (R-Squared):</strong>
                    <ul>
                        <li>Measures how "clean" the trend is (0 to 1)</li>
                        <li><em>0.8-1.0:</em> Very strong, consistent trend - more reliable forecast</li>
                        <li><em>0.5-0.8:</em> Moderate trend - some noise but generally consistent</li>
                        <li><em>Below 0.5:</em> Weak trend - price is choppy, forecast less reliable</li>
                    </ul>
                </li>
                <li><strong>Moving Averages (MA):</strong>
                    <ul>
                        <li><em>20-Day MA:</em> Short-term average price - helps confirm trend direction</li>
                        <li><em>50-Day MA:</em> Medium-term average price - stronger trend confirmation</li>
                        <li>When price is above both MAs, it's a bullish sign</li>
                        <li>When price is below both MAs, it's a bearish sign</li>
                    </ul>
                </li>
            </ul>

            <p><strong>Important Limitations:</strong></p>
            <ul>
                <li>This assumes the current trend will continue - which may not happen!</li>
                <li>Doesn't account for news, earnings, market events, or fundamental changes</li>
                <li>Best used alongside support/resistance levels and fundamental analysis</li>
                <li>Low R² means the forecast is less reliable</li>
            </ul>

            <p><strong>How to use it:</strong></p>
            <ul>
                <li>Compare trend targets with resistance/support levels to see if they align</li>
                <li>High R² + alignment with technical levels = more confidence</li>
                <li>Use as one data point, not the only factor in your decision</li>
            </ul>
        `
    },
    'pivot-points': {
        title: 'Classical Pivot Points',
        content: `
            <p><strong>What they are:</strong> Price levels calculated from the previous period's high, low, and close prices. Traders use these as potential support and resistance levels.</p>

            <p><strong>The Formula:</strong></p>
            <ul>
                <li><strong>Pivot Point (P):</strong> (High + Low + Close) / 3</li>
                <li><strong>Resistance 1 (R1):</strong> (2 × P) - Low</li>
                <li><strong>Resistance 2 (R2):</strong> P + (High - Low)</li>
                <li><strong>Resistance 3 (R3):</strong> High + 2 × (P - Low)</li>
                <li><strong>Support 1 (S1):</strong> (2 × P) - High</li>
                <li><strong>Support 2 (S2):</strong> P - (High - Low)</li>
                <li><strong>Support 3 (S3):</strong> Low - 2 × (High - P)</li>
            </ul>

            <p><strong>How traders use them:</strong></p>
            <ul>
                <li><strong>The Pivot Point:</strong> The center line
                    <ul>
                        <li>Price above pivot = bullish sentiment</li>
                        <li>Price below pivot = bearish sentiment</li>
                    </ul>
                </li>
                <li><strong>Support Levels (S1, S2, S3):</strong>
                    <ul>
                        <li>Potential "buy zones" if price drops</li>
                        <li>The lower the number (S1 → S2 → S3), the stronger the support</li>
                        <li>S3 is often seen as a major support level</li>
                    </ul>
                </li>
                <li><strong>Resistance Levels (R1, R2, R3):</strong>
                    <ul>
                        <li>Potential "sell zones" or profit targets</li>
                        <li>The higher the number (R1 → R2 → R3), the stronger the resistance</li>
                        <li>R3 is often seen as a major resistance level</li>
                    </ul>
                </li>
            </ul>

            <p><strong>Trading Strategies:</strong></p>
            <ul>
                <li><strong>Bounce Trading:</strong> Buy near support levels (S1, S2) expecting a bounce back up</li>
                <li><strong>Breakout Trading:</strong> If price breaks through R1 with volume, it may continue to R2</li>
                <li><strong>Range Trading:</strong> Trade between S1 and R1 when price is stable</li>
                <li><strong>Reversal Signals:</strong> If price reaches S3 or R3, it might reverse strongly</li>
            </ul>

            <p><strong>Important Notes:</strong></p>
            <ul>
                <li>Pivot points are most popular with day traders and swing traders</li>
                <li>They're recalculated daily based on the previous day's prices</li>
                <li>More reliable when combined with other indicators and price action</li>
                <li>Not predictive - they're just mathematically derived levels traders watch</li>
            </ul>
        `
    }
};

function showInfo(key) {
    const info = infoContent[key];
    if (!info) return;

    document.getElementById('info-modal-title').textContent = info.title;
    document.getElementById('info-modal-content').innerHTML = info.content;
    document.getElementById('info-modal-overlay').classList.add('active');
    document.body.style.overflow = 'hidden';
}

function closeInfo() {
    document.getElementById('info-modal-overlay').classList.remove('active');
    document.body.style.overflow = '';
}

document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') closeInfo();
});
</script>

<style>
/* Technical Analysis Specific Styles */

/* Forecast Header (borrowed from forecast.html) */
.forecast-header {
    background: linear-gradient(135deg, #1e2139 0%, #2d3250 100%);
    padding: 30px;
    border-radius: 12px;
    margin-bottom: 30px;
    border: 1px solid rgba(0, 255, 136, 0.2);
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 20px;
}

.forecast-header h2 {
    color: #00ff88;
    margin: 0;
    flex: 1;
    min-width: 200px;
}

.current-price {
    text-align: right;
}

.current-price .label {
    display: block;
    color: #a8b2d1;
    font-size: 0.9rem;
    text-transform: uppercase;
}

.current-price .value {
    font-size: 2.5rem;
    font-weight: 700;
    color: #ffd700;
    font-family: 'Courier New', monospace;
}

.header-actions {
    display: flex;
    gap: 10px;
    align-items: center;
}

.data-info-card {
    background: rgba(0, 255, 136, 0.05);
    padding: 20px;
    margin-bottom: 20px;
    border-left: 4px solid #00ff88;
}

.data-info-card p {
    margin: 5px 0;
    color: #a8b2d1;
}

.data-info-card .sector-info {
    font-weight: bold;
    color: #00ff88;
    margin-bottom: 10px;
}

.chart-container {
    position: relative;
    height: 400px;
    margin-top: 15px;
}

.technical-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-top: 20px;
}

@media (max-width: 768px) {
    .technical-grid {
        grid-template-columns: 1fr;
    }
}

.trend-section,
.sr-section {
    padding: 15px;
}

.trend-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.trend-badge {
    padding: 8px 16px;
    border-radius: 6px;
    font-weight: bold;
    font-size: 1.1rem;
}

.trend-badge.bullish {
    background: rgba(0, 255, 136, 0.2);
    color: #00ff88;
    border: 2px solid #00ff88;
}

.trend-badge.bearish {
    background: rgba(255, 51, 102, 0.2);
    color: #ff3366;
    border: 2px solid #ff3366;
}

.r-squared {
    color: #a8b2d1;
    font-size: 0.9rem;
}

.separator {
    background: rgba(0, 255, 136, 0.1);
}

.upside.positive {
    color: #00ff88;
    font-weight: bold;
    margin-left: 10px;
}

.upside.negative,
.downside.negative {
    color: #ff3366;
    font-weight: bold;
    margin-left: 10px;
}

.trend-note,
.sr-note {
    margin-top: 20px;
    padding: 15px;
    background: rgba(0, 255, 136, 0.05);
    border-left: 4px solid #00ff88;
    border-radius: 4px;
}

.trend-note p,
.sr-note p {
    font-size: 0.85rem;
    color: #a8b2d1;
    margin: 0;
}

/* Support/Resistance Levels */
.sr-levels {
    margin-bottom: 20px;
}

.resistance-levels,
.support-levels {
    margin-bottom: 15px;
}

.resistance-levels h4 {
    color: #ff3366;
    margin-bottom: 10px;
}

.support-levels h4 {
    color: #00ff88;
    margin-bottom: 10px;
}

.level-list {
    list-style: none;
    padding: 0;
}

.resistance-item,
.support-item {
    padding: 10px;
    margin: 5px 0;
    border-radius: 6px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.resistance-item {
    background: rgba(255, 51, 102, 0.1);
    border-left: 4px solid #ff3366;
}

.support-item {
    background: rgba(0, 255, 136, 0.1);
    border-left: 4px solid #00ff88;
}

.level-price {
    font-size: 1.1rem;
    font-weight: bold;
}

.badge.next {
    background: #ffd700;
    color: #0a0e27;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 0.75rem;
    font-weight: bold;
}

.current-price-marker {
    display: flex;
    align-items: center;
    margin: 20px 0;
    padding: 15px 10px;
    background: rgba(255, 215, 0, 0.1);
    border: 2px dashed #ffd700;
    border-radius: 6px;
}

.marker-line {
    flex-grow: 1;
    height: 2px;
    background: #ffd700;
    margin-right: 10px;
}

.marker-label {
    color: #ffd700;
    font-weight: bold;
    font-size: 1.1rem;
}


.info-text {
    color: #a8b2d1;
    font-size: 0.9rem;
    margin-bottom: 15px;
}

/* Pivot Points Table */
.pivot-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
}

.pivot-table th,
.pivot-table td {
    padding: 12px;
    text-align: center;
    border: 1px solid rgba(0, 255, 136, 0.2);
}

.pivot-table th {
    background: rgba(0, 255, 136, 0.1);
    color: #00ff88;
    font-weight: bold;
}

.pivot-table .pivot-col {
    background: rgba(255, 215, 0, 0.1);
    color: #ffd700;
}

/* Summary Section */
.summary-section {
    margin-top: 20px;
}

.summary-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-top: 15px;
}

.summary-item {
    padding: 15px;
    background: rgba(0, 255, 136, 0.05);
    border-radius: 6px;
    border: 1px solid rgba(0, 255, 136, 0.2);
}

.summary-label {
    display: block;
    color: #a8b2d1;
    font-size: 0.85rem;
    margin-bottom: 8px;
}

.summary-value {
    display: block;
    font-size: 1.3rem;
    font-weight: bold;
    color: #e0e6ed;
}

.error-card {
    background: rgba(255, 51, 102, 0.1);
    border: 2px solid #ff3366;
}

.error-message {
    color: #ff3366;
    font-size: 1.1rem;
    margin-bottom: 15px;
}

.no-data {
    color: #a8b2d1;
    font-style: italic;
    padding: 20px;
    text-align: center;
}

.price-targets-summary {
    margin-top: 20px;
    padding-top: 20px;
    border-top: 2px solid rgba(0, 255, 136, 0.2);
}

.price-targets-summary h4 {
    margin-bottom: 15px;
    color: #00ff88;
}

.search-container {
    position: relative;
}

.search-results {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: #1a1f3a;
    border: 1px solid rgba(0, 255, 136, 0.3);
    border-radius: 4px;
    max-height: 300px;
    overflow-y: auto;
    z-index: 1000;
    display: none;
}

.search-result-item {
    padding: 10px;
    cursor: pointer;
    border-bottom: 1px solid rgba(0, 255, 136, 0.1);
}

.search-result-item:hover {
    background: rgba(0, 255, 136, 0.1);
}

.search-result-item:last-child {
    border-bottom: none;
}

/* Info Button Styles */
.info-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: rgba(0, 255, 136, 0.2);
    color: #00ff88;
    border: 1px solid #00ff88;
    font-size: 12px;
    font-weight: bold;
    cursor: pointer;
    margin-left: 8px;
    transition: all 0.3s ease;
}

.info-btn:hover {
    background: #00ff88;
    color: #0a0e27;
    transform: scale(1.1);
}

/* Info Modal Styles */
.info-modal-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    z-index: 10000;
    overflow-y: auto;
}

.info-modal-overlay.active {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
}

.info-modal {
    background: linear-gradient(135deg, #1a1f3a 0%, #0a0e27 100%);
    border: 2px solid #00ff88;
    border-radius: 12px;
    max-width: 700px;
    width: 100%;
    max-height: 80vh;
    overflow-y: auto;
    padding: 30px;
    position: relative;
    box-shadow: 0 10px 40px rgba(0, 255, 136, 0.3);
}

.info-modal h3 {
    color: #00ff88;
    margin-top: 0;
    margin-bottom: 20px;
    font-size: 1.5rem;
}

.info-modal p {
    color: #e0e6ed;
    line-height: 1.6;
    margin-bottom: 15px;
}

.info-modal ul {
    color: #e0e6ed;
    line-height: 1.6;
    margin-bottom: 15px;
    padding-left: 25px;
}

.info-modal li {
    margin-bottom: 8px;
}

.info-modal strong {
    color: #ffd700;
}

.info-modal em {
    color: #00bfff;
    font-style: normal;
}

.info-modal-close {
    position: absolute;
    top: 15px;
    right: 15px;
    background: rgba(255, 51, 102, 0.2);
    border: 1px solid #ff3366;
    color: #ff3366;
    font-size: 28px;
    width: 35px;
    height: 35px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    line-height: 1;
}

.info-modal-close:hover {
    background: #ff3366;
    color: white;
    transform: rotate(90deg);
}

/* Scrollbar for modal */
.info-modal::-webkit-scrollbar {
    width: 8px;
}

.info-modal::-webkit-scrollbar-track {
    background: rgba(0, 0, 0, 0.3);
    border-radius: 10px;
}

.info-modal::-webkit-scrollbar-thumb {
    background: #00ff88;
    border-radius: 10px;
}

.info-modal::-webkit-scrollbar-thumb:hover {
    background: #00cc70;
}
</style>

{% endblock %}
