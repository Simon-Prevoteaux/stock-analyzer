{% extends "base.html" %}

{% block title %}Value Plays{% endblock %}

{% block content %}
<h1>Value Plays</h1>
<p class="subtitle">Stocks with P/E &lt; 20 and P/S &lt; 3 that are profitable</p>

{% if stocks %}
<div class="table-container">
    <table class="stock-table sortable-table">
        <thead>
            <tr>
                <th data-sortable data-type="string">Ticker</th>
                <th data-sortable data-type="string">Company</th>
                <th data-sortable data-type="number">Market Cap</th>
                <th data-sortable data-type="number">P/E Ratio</th>
                <th data-sortable data-type="number">P/S Ratio</th>
                <th data-sortable data-type="number">Revenue Growth</th>
                <th data-sortable data-type="number">Profit Margin</th>
                <th data-sortable data-type="string">Sector</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for stock in stocks %}
            <tr>
                <td><a href="{{ url_for('stock_detail', ticker=stock.ticker) }}">{{ stock.ticker }}</a></td>
                <td>{{ stock.company_name }}</td>
                <td data-value="{{ stock.market_cap or 0 }}">{{ stock.market_cap|format_number }}</td>
                <td data-value="{{ stock.pe_ratio or 0 }}">{{ stock.pe_ratio|format_ratio }}</td>
                <td data-value="{{ stock.ps_ratio or 0 }}">{{ stock.ps_ratio|format_ratio }}</td>
                <td data-value="{{ stock.revenue_growth or 0 }}">{{ stock.revenue_growth|format_percent }}</td>
                <td data-value="{{ stock.profit_margin or 0 }}">{{ stock.profit_margin|format_percent }}</td>
                <td>{{ stock.sector }}</td>
                <td><a href="{{ url_for('stock_detail', ticker=stock.ticker) }}" class="btn btn-sm">View</a></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="no-results-box">
    <p>No value plays found in the database.</p>
    <p class="hint">Value plays require: P/E &lt; 20, P/S &lt; 3, and positive earnings</p>
</div>
{% endif %}

<!-- Near Value Plays Section -->
<div class="near-value-section">
    <h2>Watchlist Zone</h2>
    <p class="subtitle">Stocks approaching value territory - close on one or both metrics</p>

    <div class="criteria-legend">
        <span class="legend-item"><span class="criteria-badge pe-close">P/E 20-30</span> Close on P/E</span>
        <span class="legend-item"><span class="criteria-badge ps-close">P/S 3-5</span> Close on P/S</span>
        <span class="legend-item"><span class="criteria-badge pe-good">P/E &lt; 20</span> Good P/E</span>
        <span class="legend-item"><span class="criteria-badge ps-good">P/S &lt; 3</span> Good P/S</span>
    </div>

    {% if near_value_stocks %}
    <div class="table-container">
        <table class="stock-table sortable-table">
            <thead>
                <tr>
                    <th data-sortable data-type="string">Ticker</th>
                    <th data-sortable data-type="string">Company</th>
                    <th data-sortable data-type="number">P/E Ratio</th>
                    <th data-sortable data-type="number">P/S Ratio</th>
                    <th>Status</th>
                    <th data-sortable data-type="number">Revenue Growth</th>
                    <th data-sortable data-type="number">Profit Margin</th>
                    <th data-sortable data-type="string">Sector</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for stock in near_value_stocks %}
                <tr>
                    <td><a href="{{ url_for('stock_detail', ticker=stock.ticker) }}">{{ stock.ticker }}</a></td>
                    <td>{{ stock.company_name }}</td>
                    <td data-value="{{ stock.pe_ratio or 0 }}">
                        {{ stock.pe_ratio|format_ratio }}
                        {% if stock.pe_ratio and stock.pe_ratio <= 20 %}
                        <span class="criteria-badge pe-good" title="P/E in value range">OK</span>
                        {% elif stock.pe_ratio and stock.pe_ratio <= 30 %}
                        <span class="criteria-badge pe-close" title="P/E approaching value range">Close</span>
                        {% endif %}
                    </td>
                    <td data-value="{{ stock.ps_ratio or 0 }}">
                        {{ stock.ps_ratio|format_ratio }}
                        {% if stock.ps_ratio and stock.ps_ratio <= 3 %}
                        <span class="criteria-badge ps-good" title="P/S in value range">OK</span>
                        {% elif stock.ps_ratio and stock.ps_ratio <= 5 %}
                        <span class="criteria-badge ps-close" title="P/S approaching value range">Close</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if stock.pe_ratio and stock.pe_ratio <= 20 %}
                            <span class="status-text">Needs P/S drop</span>
                        {% elif stock.ps_ratio and stock.ps_ratio <= 3 %}
                            <span class="status-text">Needs P/E drop</span>
                        {% else %}
                            <span class="status-text">Close on both</span>
                        {% endif %}
                    </td>
                    <td data-value="{{ stock.revenue_growth or 0 }}">{{ stock.revenue_growth|format_percent }}</td>
                    <td data-value="{{ stock.profit_margin or 0 }}">{{ stock.profit_margin|format_percent }}</td>
                    <td>{{ stock.sector }}</td>
                    <td><a href="{{ url_for('stock_detail', ticker=stock.ticker) }}" class="btn btn-sm">View</a></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="no-results-box">
        <p>No stocks in the watchlist zone.</p>
    </div>
    {% endif %}
</div>

<style>
.near-value-section {
    margin-top: 50px;
    padding-top: 30px;
    border-top: 2px solid rgba(255, 215, 0, 0.3);
}

.near-value-section h2 {
    color: #ffd700;
    margin-bottom: 10px;
}

.criteria-legend {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    margin-bottom: 25px;
    padding: 15px;
    background: rgba(10, 14, 39, 0.4);
    border-radius: 8px;
}

.legend-item {
    display: flex;
    align-items: center;
    gap: 8px;
    color: #a8b2d1;
    font-size: 0.9rem;
}

.criteria-badge {
    display: inline-block;
    padding: 3px 8px;
    border-radius: 4px;
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    margin-left: 5px;
}

.criteria-badge.pe-close {
    background: rgba(255, 215, 0, 0.2);
    color: #ffd700;
    border: 1px solid rgba(255, 215, 0, 0.4);
}

.criteria-badge.ps-close {
    background: rgba(255, 153, 51, 0.2);
    color: #ff9933;
    border: 1px solid rgba(255, 153, 51, 0.4);
}

.criteria-badge.pe-good {
    background: rgba(0, 255, 136, 0.2);
    color: #00ff88;
    border: 1px solid rgba(0, 255, 136, 0.4);
}

.criteria-badge.ps-good {
    background: rgba(0, 255, 136, 0.2);
    color: #00ff88;
    border: 1px solid rgba(0, 255, 136, 0.4);
}

.status-text {
    color: #a8b2d1;
    font-size: 0.85rem;
    font-style: italic;
}

.no-results-box {
    background: rgba(10, 14, 39, 0.4);
    padding: 30px;
    border-radius: 8px;
    text-align: center;
}

.no-results-box p {
    color: #a8b2d1;
    margin: 0;
}

.no-results-box .hint {
    margin-top: 10px;
    font-size: 0.9rem;
    color: #6b7a99;
}

@media (max-width: 768px) {
    .criteria-legend {
        flex-direction: column;
        gap: 10px;
    }
}
</style>
{% endblock %}
